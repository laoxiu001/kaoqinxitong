<!DOCTYPE html>
<!--[if lt IE 7]>

<html class="lt-ie9 lt-ie8 lt-ie7" lang="en">

<![endif]-->
<!--[if IE 7]>

<html class="lt-ie9 lt-ie8" lang="en">

<![endif]-->
<!--[if IE 8]>

<html class="lt-ie9" lang="en">

<![endif]-->
<!--[if gt IE 8]>
<!-->

<html lang="en">

<!--
<![endif]-->
<head>
    <meta charset="utf-8">
    <title>
        考勤系统-部门信息
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->

    <link href="static/icomoon/style.css" rel="stylesheet">
    <link href="static/css/main.css" rel="stylesheet">
    <!-- Important. For Theming change primary-color variable in main.css  -->
    <link href="static/css/alertify.core.css" rel="stylesheet" id="toggleCSS">
    <!--[if lte IE 7]>
    <script src="static/css/icomoon-font/lte-ie7.js">
    </script>
    <![endif]-->

</head>
<body onload="message('success','跳转成功');">
<!-- 头部状态栏 start -->
<header>
    <a href="#" class="logo">
        <img src="static/img/logo.png" alt="Logo"/>
    </a>
    <div class="btn-group">
        <button class="btn btn-primary">
            早上好，admin ！
        </button>
        <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle">
          <span class="caret">
          </span>
        </button>
        <ul class="dropdown-menu pull-right">
            <li>
                <a href="#myModal" role="button" data-toggle="modal">
                    修改密码
                </a>
            </li>
            <li>
                <a href="#">
                    注销账户
                </a>
            </li>
        </ul>
    </div>
</header>
<!-- 头部状态栏 end -->
<!-- 主体内容 start -->
<div class="container-fluid">
    <div class="dashboard-container">
        <!--头部主导航栏-->
        <div class="top-nav">
            <ul>
                <li>
                    <a href="punch.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe0a0;"></div>
                        打卡测试
                    </a>
                </li>
                <li>
                    <a href="employeeManage.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe072;"></div>
                        员工信息
                    </a>
                </li>
                <li>
                    <a href="department.html" class="selected">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe0a9;"></div>
                        部门信息
                    </a>
                </li>
                <li>
                    <a href="position.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe073;"></div>
                        职位管理
                    </a>
                </li>
                <li>
                    <a href="leaveRecord.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe0e4;"></div>
                        请假管理
                    </a>
                </li>
                <li>
                    <a href="shiftManagement.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe075;"></div>
                        班次管理
                    </a>
                </li>
                <li>
                    <a href="attence.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe096;"></div>
                        考勤管理
                    </a>
                </li>
                <li>
                    <a href="result.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe0b8;"></div>
                        考勤结果管理
                    </a>
                </li>
                <li>
                    <a href="permission.html">
                        <div class="fs1" aria-hidden="true" data-icon="&#xe0fe;"></div>
                        权限管理
                    </a>
                </li>
            </ul>
            <div class="clearfix">
            </div>
        </div>
        <!--头部副导航栏-->
        <div class="sub-nav">
            <ul>
                <li><a href="#" class="heading">部门信息</a></li>
            </ul>
        </div>
        <div class="dashboard-wrapper">
            <div class="left-sidebar">

                <div class="row-fluid">

                    <div class="span12">
                        <!-- 部门信息 -->
                        <div class="widget">
                            <div class="widget-header">
                                <div class="title" id="list">
                                    部门列表
                                </div>
                                <span class="tools">
                      <a class="fs1" aria-hidden="true" data-icon="" data-original-title=""></a>
                    </span>
                            </div>
                            <div class="widget-body">
                                <div id="dt_example" class="example_alt_pagination">
                                    <div id="data-table_wrapper" class="dataTables_wrapper" role="grid">
                                        <!-- 添加部门按钮 -->
                                        <button class="btn btn-primary" href="#edit" data-toggle="modal"
                                                onclick="lick(this, this.id)">添加部门
                                        </button>
                                        <!-- 部门信息列表 -->
                                        <table class="table table-condensed table-striped table-hover table-bordered pull-left dataTable"
                                               id="data-table1" aria-describedby="data-table_info">

                                            <thead>
                                            <tr role="row">
                                                <th>
                                                    部门编号
                                                </th>
                                                <th>
                                                    部门名称
                                                </th>
                                                <th>
                                                    打卡地址
                                                </th>
                                                <th>
                                                    考勤方式
                                                </th>
                                                <th>
                                                    部门员工数
                                                </th>
                                                <th>
                                                    操作
                                                </th>
                                            </tr>
                                            </thead>

                                            <tbody id="table_department" role="alert" aria-live="polite"
                                                   aria-relevant="all">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右边员工预览 -->
            <div class="right-sidebar">
                <div class="wrapper">
                    <ul class="stats">
                        <li>
                            <div class="metro-nav-block nav-block-yellow current">
                                <a href="#">
                                    <div class="brand">
                                        <div class="pull-left fs1" aria-hidden="true" data-icon="&#xe000;"></div>
                                        <p class="pull-left">&nbsp;部门员工数：</p>
                                        <h3 class="pull-right">15,859</h3>
                                        <div class="clearfix"></div>
                                    </div>
                                </a>
                            </div>
                        </li>
                        <li>
                            <div class="metro-nav-block nav-block-yellow current">
                                <a href="#">
                                    <div class="brand">
                                        <div class="pull-left fs1" aria-hidden="true" data-icon="&#xe01b;"></div>
                                        <p class="pull-left">&nbsp;今日应到人数：</p>
                                        <h3 class="pull-right">15,857</h3>
                                        <div class="clearfix"></div>
                                    </div>
                                </a>
                            </div>
                        </li>
                        <li>
                            <div class="metro-nav-block nav-block-yellow current">
                                <a href="#">
                                    <div class="brand">
                                        <div class="pull-left fs1" aria-hidden="true" data-icon="&#xe070;"></div>
                                        <p class="pull-left">&nbsp;今日实到人数：</p>
                                        <h3 class="pull-right">15,853</h3>
                                        <div class="clearfix"></div>
                                    </div>
                                </a>
                            </div>
                        </li>
                        <li>
                            <div class="metro-nav-block nav-block-yellow current">
                                <a href="#">
                                    <div class="brand">
                                        <div class="pull-left fs1" aria-hidden="true" data-icon="&#xe006;"></div>
                                        <p class="pull-left">&nbsp;请假人数：</p>
                                        <h3 class="pull-right">2</h3>
                                        <div class="clearfix"></div>
                                    </div>
                                </a>
                            </div>
                        </li>
                        <li>
                            <div class="metro-nav-block nav-block-yellow current">
                                <a href="#">
                                    <div class="brand">
                                        <div class="pull-left fs1" aria-hidden="true" data-icon="&#xe04b;"></div>
                                        <p class="pull-left">&nbsp;缺勤人数：</p>
                                        <h3 class="pull-right">4</h3>
                                        <div class="clearfix"></div>
                                    </div>
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!--/.fluid-container-->
</div>
<!-- 主体内容 end -->
<!-- 修改部门信息模态框 start -->
<div id="edit" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
        </button>
        <h3>
            <a class="fs1" aria-hidden="true" data-icon="&#xe1c8;"></a>
            修改部门信息
        </h3>
    </div>
    <form class="form-horizontal no-margin" id="departmentForm">
        <table>
            <div class="modal-body">
                <div class="tab-content" id="">
                    <div class="tab-pane fade active in">

                        <div class="control-group">
                            <label class="control-label" for="name">
                                部门名称
                            </label>
                            <div class="controls">
                                <input type="text" id="name" placeholder="请输入部门名称" name="name">
                                <span style="color: red;" id="span_name"></span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="address">
                                打卡地址
                            </label>
                            <div class="controls">
                                <input type="text" id="address" placeholder="请输入打卡地址" name="address">
                                <span style="color: red;" id="span_address"></span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="type">
                                考勤方式
                            </label>
                            <div class="controls">
                                <select name="type" id="type">
                                    <option value="">-- 请选择考勤方式 --</option>
                                    <option value="打卡考勤">打卡考勤</option>
                                    <option value="人工考勤">人工考勤</option>
                                    <option value="指纹考勤">指纹考勤</option>
                                </select>
                                <span style="color: red;" id="span_type"></span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="number">
                                部门员工数
                            </label>
                            <div class="controls">
                                <input type="text" id="number" name="number" value="员工数">
                                <span style="color: red;" id="span_number"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="button" onclick="edit()">
                    提交
                </button>
                <button class="btn" data-dismiss="modal" aria-hidden="true">
                    关闭
                </button>
            </div>
        </table>
    </form>
</div>
<!-- 修改密码模态框 start -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
        </button>
        <h3 id="myModalLabel">
            <a class="fs1" aria-hidden="true" data-icon="&#xe1c8;"></a>
            修改密码
        </h3>
    </div>
    <form class="form-horizontal no-margin" id="passwordForm">
        <table>
            <div class="modal-body">
                <div class="tab-content" id="myTabContent">
                    <div id="step1" class="tab-pane fade active in">

                        <div class="control-group">
                            <label class="control-label" for="password">
                                当前密码
                            </label>
                            <div class="controls">
                                <input type="password" id="password" name="currencyPassword" placeholder="请输入当前密码">
                                <span style="color: red;" id="span_password"></span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="newPassword_1">
                                修改密码
                            </label>
                            <div class="controls">
                                <input type="password" id="newPassword_1" name="newPassword" placeholder="请输入要修改的密码">
                                <span style="color: red;" id="span_newPassword_1"></span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="newPassword_2">
                                确认密码
                            </label>
                            <div class="controls">
                                <input type="password" id="newPassword_2" name="confirmPassword" placeholder="请确认要修改的密码">
                                <span style="color: red;" id="span_newPassword_2"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="button" onclick="changePassword()">
                    提交
                </button>
                <button class="btn" data-dismiss="modal" aria-hidden="true">
                    关闭
                </button>
            </div>
        </table>
    </form>
</div>
<!-- 修改密码模态框 end -->
<!-- 底部footer start -->
<footer>
    <p>
        &copy; 雷格SS Copyright 2018 Powered by Bootstrap! F1.0 备：沪ICP备41749849号-3
    </p>
</footer>
<!-- 底部footer end -->


<script src="static/js/jquery.min.js">
</script>
<script src="static/js/bootstrap.js">
</script>
<script type="text/javascript" src="static/js/alertify.min.js">
</script>
<script src="static/js/jquery.scrollUp.js">
</script>
<script src="static/js/jquery.dataTables.js">
</script>
//主JS代码
<script type="text/javascript" src="static/js/main.js">
</script>
<script>
    /*
     * 页面加载自动执行方法
     * 注意加载顺序！
     * */
    //加载部门信息列表数据
    $(document).ready(function () {
        getDepartment();
    });

    //Data Tables
    $(document).ready(function () {
        $('#data-table1').dataTable({
            "sPaginationType": "full_numbers"
        });
    });

</script>
<script>
    function getDepartment() {
        $.ajax({
            catch: false,
            type: "GET",
            url: "static/data/department.txt",
            data: "department_id=1",
            dataType: "json",
            async: false,
            error: function (request) {
                console.log(request.error);
            },
            success: function (data) {
                var html = "";
                for (var i = 0; i < data.length; i++) {
                    html += "<tr>";
                    for (attr in data[i]) {
                        html += "<td>";
                        html += data[i][attr];
                        html += "</td>";
                    }
                    html += "<td><button class=\"btn btn-primary\" href=\"#edit\" data-toggle=\"modal\" onclick=\"lick(this, this.id)\">编辑 </button>";
                    html += "<button class=\"btn btn-danger\" onclick=\"del()\">删除</button> </td>";
                    html += "</tr>";
                }
                //将拼接完成的table传入表格元素节点内
                $("#table_department").append(html);
            }

        })
    }

    //Alertify JS插件初始化
    reset = function () {
        $("toggleCSS").href = "css/alertify.core.css";
        alertify.set({
            labels: {
                cancel: "确认",
                ok: "取消",
            },
            delay: 3000,
            buttonReverse: false,
            buttonFocus: "ok"
        });
    };
    //删除按钮点击事件
    function del() {
        reset();
        alertify.confirm("确认删除该条记录吗？", function (e) {
            if (e) {
                //用户点击了取消按钮，不执行操作
            } else {
                alertify.success("删除成功");
            }
        });
        return false;
    }

    function lick(obj, id) {
        var td_content = $(obj).parents("tr").children("td");  //获取当前行中的所有td值

        var name = td_content.eq(1).text(); //获取当前行第二个td的值
        var address = td_content.eq(2).text(); //获取当前行第二个td的值
        var type = td_content.eq(3).text(); //获取当前行第二个td的值
        var number = td_content.eq(4).text(); //获取当前行第二个td的值

        document.getElementById('name').value = name;
        document.getElementById('address').value = address;
        document.getElementById('type').value = type;
        document.getElementById('number').value = number;
    }

    //清除 span 提示文字
    function resetEdit() {
        document.getElementById("span_name").innerHTML = '';
        document.getElementById("span_address").innerHTML = '';
        document.getElementById("span_type").innerHTML = '';
        document.getElementById("span_number").innerHTML = '';
    }
    ;

    //隐藏编辑模态框时清除span
    $('#edit').on('hide.bs.modal', function () {
        resetEdit();
    })

    //编辑部门信息表单验证
    function edit() {
        resetEdit();
        var name = document.getElementById('name').value;
        var address = document.getElementById('address').value;
        var type = document.getElementById('type').value;
        var number = document.getElementById('number').value;
        if (name == "") {
            document.getElementById("span_name").innerHTML = '请输入部门名称';
            return false;
        } else if (address == "") {
            document.getElementById("span_address").innerHTML = '请输入打卡地址';
            return false;
        } else if (type == "") {
            document.getElementById("span_type").innerHTML = '请选择考勤方式';
            return false;
        } else if (number == "") {
            document.getElementById("span_number").innerHTML = '员工数异常，请联系管理员';
            return false;
        }
        //获取表单数据
        var departmentFormJson = $('#departmentForm').serializeArray();
        //构造请求参数
        var departmentSubmitJson = {
            name: departmentFormJson[0].value,
            address: departmentFormJson[1].value,
            type: departmentFormJson[2].value,
            number: parseInt(departmentFormJson[3].value)
        };
        $.ajax({
            catch: false,
            type: "POST",
            url: "/attend/insert",
            data: departmentSubmitJson,
            async: false,
            success: function (data) {
                if (data == "SUCCESS") {
                    //打卡成功
                    message('success', '成功');
                } else if (data == "fail") {
                    //打卡失败
                    message('error', '失败');
                } else {
                    //其他错误信息
                    message('error', 'data');
                }
            }
        })
    }
</script>
</body>
</html>